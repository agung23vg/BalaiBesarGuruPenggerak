<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Admin - BBGP Parung</title>
  <link rel="icon" href="bbgp.png" type="image/x-icon">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f9fafb;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #1e3a8a;
      color: white;
      padding: 1rem;
    }

    .header-flex {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    .header-logo {
      width: 50px;
      height: 50px;
      margin-right: 1rem;
    }

    .header-title-group h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .header-title-group p {
      margin: 0;
      font-size: 1rem;
    }

    .admin-header {
      padding: 1rem;
      background-color: #e5e7eb;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
    }

    .admin-header h2 {
      margin: 0.5rem 0;
      font-size: 1.3rem;
    }

    .logout-btn {
      background-color: #1f2937;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      margin: 0.5rem 0;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow-x: auto;
    }

    .admin-table th,
    .admin-table td {
      border: 1px solid #d1d5db;
      padding: 8px 10px;
      text-align: center;
      font-size: 0.95rem;
    }

    .admin-table th {
      background-color: #f3f4f6;
    }

    .edit-btn, .delete-btn, .save-btn, .cancel-btn {
      padding: 6px 10px;
      margin: 2px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .edit-btn { background-color: #2563eb; color: white; }
    .delete-btn { background-color: #dc2626; color: white; }
    .save-btn { background-color: #059669; color: white; }
    .cancel-btn { background-color: #6b7280; color: white; }

    /* Responsive Table Container */
    #admin-booking-container {
      overflow-x: auto;
      padding: 0 1rem;
    }

    @media (max-width: 768px) {
      .header-title-group h1 {
        font-size: 1.2rem;
      }

      .header-title-group p {
        font-size: 0.9rem;
      }

      .admin-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .admin-header h2 {
        font-size: 1.1rem;
      }

      .logout-btn {
        align-self: flex-end;
      }

      .admin-table th, .admin-table td {
        font-size: 0.85rem;
        padding: 6px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-flex">
      <img src="bbgp.png" alt="Logo BBGP" class="header-logo">
      <div class="header-title-group">
        <h1>Dashboard Admin BBGP Parung</h1>
        <p>Kelola Data Booking Lapangan</p>
      </div>
    </div>
  </header>

  <div class="admin-header">
    <h2>Daftar Booking Lapangan</h2>
    <button onclick="logout()">Logout</button>
  </div>

  <div id="admin-booking-container">
    <table class="admin-table" id="admin-booking-table">
      <thead>
        <tr>
          <th>Nama</th>
          <th>Lapangan</th>
          <th>Tanggal</th>
          <th>Jam</th>
          <th>Durasi</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data booking tampil di sini -->
      </tbody>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient(
      'https://eiqkjwjbpbhjieijtjad.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpcWtqd2picGJoamllaWp0amFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyMzQzMjAsImV4cCI6MjA2MjgxMDMyMH0.-MPUvR5OePkNkq2NCoNY5ecFNNaLJLm7K4mMFnoKBWI'
    );

    let booking = [];
    let editingId = null;

    async function fetchAdminBookings() {
      const { data, error } = await supabase
        .from('booking')
        .select('*')
        .order('date', { ascending: true });

      if (error) {
        alert('Gagal mengambil data booking');
        return;
      }

      booking = data || [];
      renderAdminBookings();
    }

    function renderAdminBookings() {
      const tbody = document.querySelector('#admin-booking-table tbody');
      tbody.innerHTML = '';
      if (booking.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7">Belum ada data booking</td></tr>';
        return;
      }

      booking.forEach(b => {
        if (editingId === b.id) {
          tbody.innerHTML += `
            <tr>
              <td><input type="text" id="edit-nama" value="${b.nama || ''}"></td>
              <td><input type="text" id="edit-field" value="${b.field || ''}"></td>
              <td><input type="date" id="edit-date" value="${b.date || ''}"></td>
              <td><input type="text" id="edit-time" value="${b.time || ''}"></td>
              <td><input type="number" id="edit-duration" value="${b.duration || 1}" min="1" max="12"></td>
              <td>
                <select id="edit-status">
                  <option value="Menunggu Konfirmasi" ${b.status === 'Menunggu Konfirmasi' ? 'selected' : ''}>Menunggu Konfirmasi</option>
                  <option value="Dikonfirmasi" ${b.status === 'Dikonfirmasi' ? 'selected' : ''}>Dikonfirmasi</option>
                  <option value="Selesai" ${b.status === 'Selesai' ? 'selected' : ''}>Selesai</option>
                  <option value="Dibatalkan" ${b.status === 'Dibatalkan' ? 'selected' : ''}>Dibatalkan</option>
                </select>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="save-btn" onclick="saveEdit('${b.id}')">Simpan</button>
                  <button class="cancel-btn" onclick="cancelEdit()">Batal</button>
                </div>
              </td>
            </tr>`;
        } else {
          tbody.innerHTML += `
            <tr>
              <td>${b.nama || ''}</td>
              <td>${b.field || ''}</td>
              <td>${b.date || ''}</td>
              <td>${b.time || ''}</td>
              <td>${b.duration || ''} jam</td>
              <td>${b.status || ''}</td>
              <td>
                <div class="action-buttons">
                  <button class="edit-btn" onclick="editBooking('${b.id}')">Edit</button>
                  <button class="delete-btn" onclick="deleteBooking('${b.id}')">Hapus</button>
                </div>
              </td>
            </tr>`;
        }
      });
    }

    window.editBooking = function(id) {
      editingId = id;
      renderAdminBookings();
    };

    window.cancelEdit = function() {
      editingId = null;
      renderAdminBookings();
    };

    window.saveEdit = async function(id) {
      const nama = document.getElementById('edit-nama').value;
      const field = document.getElementById('edit-field').value;
      const date = document.getElementById('edit-date').value;
      const time = document.getElementById('edit-time').value;
      const duration = parseInt(document.getElementById('edit-duration').value);
      const status = document.getElementById('edit-status').value;

      const { error } = await supabase
        .from('booking')
        .update({ nama, field, date, time, duration, status })
        .eq('id', id);

      if (error) {
        alert('Gagal mengedit booking: ' + error.message);
        return;
      }

      editingId = null;
      await fetchAdminBookings();
    };

    window.deleteBooking = async function(id) {
      if (!confirm('Yakin ingin menghapus booking ini?')) return;
      const { error } = await supabase.from('booking').delete().eq('id', id);
      if (error) {
        alert('Gagal menghapus booking');
        return;
      }
      await fetchAdminBookings();
    };

    window.logout = async function() {
      await supabase.auth.signOut();
      window.location.href = 'login.html';
    };

    async function checkAdmin() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user || user.email !== 'bbgpparung@gmail.com') {
        alert('Anda bukan admin!');
        window.location.href = 'login.html';
      }
    }

    window.onload = async function() {
      await checkAdmin();
      await fetchAdminBookings();
    };
  </script>
</body>
</html>
